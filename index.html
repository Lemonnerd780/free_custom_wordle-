<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Creator Pro</title>
    <style>
        :root {
            --color-correct: #6aaa64;
            --color-present: #c9b458;
            --color-absent: #3a3a3c;
            --color-border: #3a3a3c;
            --bg: #121213;
        }

        body { font-family: sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; padding: 20px; }
        
        .setup-box { background: #1e1e1f; padding: 30px; border-radius: 10px; display: inline-block; border: 1px solid #333; margin-top: 50px; }
        input { padding: 12px; font-size: 1.2rem; background: #000; border: 1px solid #444; color: white; border-radius: 5px; text-transform: uppercase; width: 250px; }
        button { padding: 12px 20px; background: var(--color-correct); color: white; border: none; font-weight: bold; border-radius: 5px; cursor: pointer; margin: 10px; }

        #grid { display: grid; gap: 5px; justify-content: center; margin-top: 20px; }

        .tile { width: 58px; height: 58px; perspective: 1000px; }
        .tile-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flipped .tile-inner { transform: rotateX(180deg); }

        .tile-front, .tile-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: bold; text-transform: uppercase;
            border: 2px solid var(--color-border); box-sizing: border-box;
        }

        .tile-back { transform: rotateX(180deg); border: none; color: white; }

        .pop { animation: pop 0.1s ease-in-out; }
        @keyframes pop { 50% { transform: scale(1.1); } }
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .correct .tile-back { background: var(--color-correct); }
        .present .tile-back { background: var(--color-present); }
        .absent .tile-back { background: var(--color-absent); }

        #message { height: 40px; margin: 20px; font-weight: bold; font-size: 1.2rem; color: #f1c40f; }
    </style>
</head>
<body>

    <div id="setup">
        <div class="setup-box">
            <h1>Wordle Builder</h1>
            <p>Enter a secret word (3-12 letters):</p>
            <input type="text" id="wInput" maxlength="12">
            <br>
            <button onclick="makeLink()">Generate Challenge Link</button>
            <div id="out" style="margin-top:20px; word-break: break-all; max-width: 350px; font-size: 0.8rem;"></div>
        </div>
    </div>

    <div id="game" style="display:none;">
        <h1 id="game-head" style="letter-spacing: 5px;">WORDLE</h1>
        <div id="grid"></div>
        <div id="message"></div>
        <button id="share" style="display:none; background:#2f7ed8" onclick="doShare()">SHARE RESULTS ðŸŸ©</button>
        <br>
        <button onclick="window.location.search=''" style="background:#444">NEW GAME / CREATE</button>
    </div>

<script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    let target = "";
    let curRow = 0;
    let curGuess = "";
    let gameOver = false;
    let emojis = [];
    let maxAllowed = 6;

    if (code) {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        try { 
            target = atob(code).toUpperCase(); 
            maxAllowed = target.length + 1; // Formula: Length + 1
            initGrid(); 
        } catch(e) { window.location.search = ""; }
    }

    function makeLink() {
    const val = document.getElementById('wInput').value.trim();
    if (val.length < 3) {
        alert("Please enter at least 3 letters.");
        return;
    }

    // This ensures we get the clean URL without old codes attached
    const baseUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
    const finalUrl = baseUrl + "?code=" + btoa(val);
    
    const outputDiv = document.getElementById('out');
    outputDiv.innerHTML = `
        <p style="color: #6aaa64; font-weight: bold;">Challenge Created!</p>
        <textarea id="cp" readonly style="width:100%; background:#000; color:#fff; border:1px solid #444; padding:5px; font-size:0.8rem; height:50px;">${finalUrl}</textarea>
        <button onclick="copyIt()" id="copyBtn" style="background:#555; width:100%;">Copy to Clipboard</button>
    `;
}

async function copyIt() {
    const copyText = document.getElementById("cp");
    const btn = document.getElementById("copyBtn");

    // Try modern Clipboard API first (Best for Phone)
    if (navigator.clipboard && navigator.clipboard.writeText) {
        try {
            await navigator.clipboard.writeText(copyText.value);
            btn.innerText = "COPIED!";
            btn.style.background = "#6aaa64";
        } catch (err) {
            fallbackCopy(copyText, btn);
        }
    } else {
        fallbackCopy(copyText, btn);
    }
}

function fallbackCopy(textEl, btn) {
    textEl.select();
    textEl.setSelectionRange(0, 99999); // For mobile
    document.execCommand("copy");
    btn.innerText = "COPIED!";
    btn.style.background = "#6aaa64";
}

    function initGrid() {
        const g = document.getElementById('grid');
        g.style.gridTemplateColumns = `repeat(${target.length}, 58px)`;
        for (let i = 0; i < maxAllowed * target.length; i++) {
            const t = document.createElement('div');
            t.className = 'tile'; t.id = 't-' + i;
            t.innerHTML = `<div class="tile-inner"><div class="tile-front"></div><div class="tile-back"></div></div>`;
            g.appendChild(t);
        }
        window.addEventListener('keydown', (e) => {
    const key = e.key;
    if (gameOver) return;
    if (key === 'Enter') submit();
    else if (key === 'Backspace') del();
    else if (/^[a-zA-Z]$/.test(key)) add(key.toUpperCase());
});
            if (gameOver) return;
            if (e.key === 'Enter') submit();
            else if (e.key === 'Backspace') del();
            else if (/^[a-zA-Z]$/.test(e.key)) add(e.key.toUpperCase());
        };
    }

    function add(l) {
        if (curGuess.length < target.length) {
            const tile = document.getElementById('t-' + (curRow * target.length + curGuess.length));
            tile.querySelector('.tile-front').innerText = l;
            tile.classList.add('pop');
            curGuess += l;
        }
    }

    function del() {
        if (curGuess.length > 0) {
            curGuess = curGuess.slice(0, -1);
            const tile = document.getElementById('t-' + (curRow * target.length + curGuess.length));
            tile.querySelector('.tile-front').innerText = "";
            tile.classList.remove('pop');
        }
    }

    async function submit() {
        if (curGuess.length !== target.length) return;
        const msg = document.getElementById('message');
        
        // Dictionary check (skips if guess is exactly the target)
        if (curGuess !== target) {
            msg.innerText = "Checking dictionary...";
            try {
                const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${curGuess}`);
                if (!res.ok) { msg.innerText = "NOT IN WORD LIST"; shake(); return; }
            } catch (e) {}
        }

        msg.innerText = "";
        
        const guessArr = curGuess.split('');
        const targetArr = target.split('');
        const states = Array(target.length).fill('absent');
        const targetLetterCount = {};

        // Count letters in target for duplicate handling
        targetArr.forEach(l => targetLetterCount[l] = (targetLetterCount[l] || 0) + 1);

        // Pass 1: Greens (Exact matches)
        guessArr.forEach((l, i) => {
            if (l === targetArr[i]) {
                states[i] = 'correct';
                targetLetterCount[l]--;
            }
        });

        // Pass 2: Yellows (Exist elsewhere)
        guessArr.forEach((l, i) => {
            if (states[i] !== 'correct' && targetLetterCount[l] > 0) {
                states[i] = 'present';
                targetLetterCount[l]--;
            }
        });

        let rowEmo = "";
        for (let i = 0; i < target.length; i++) {
            const t = document.getElementById('t-' + (curRow * target.length + i));
            t.querySelector('.tile-back').innerText = guessArr[i];
            
            setTimeout(() => {
                t.classList.add(states[i]);
                t.classList.add('flipped');
                rowEmo += states[i] === 'correct' ? "ðŸŸ©" : (states[i] === 'present' ? "ðŸŸ¨" : "â¬›");

                if (i === target.length - 1) {
                    emojis.push(rowEmo);
                    checkEnd();
                }
            }, i * 150);
        }
    }

    function shake() {
        for (let i = 0; i < target.length; i++) {
            const t = document.getElementById('t-' + (curRow * target.length + i));
            t.classList.add('shake');
            setTimeout(() => t.classList.remove('shake'), 500);
        }
    }

    function checkEnd() {
        if (curGuess === target) { 
            document.getElementById('message').innerText = "SPLENDID!"; 
            end(); 
        } else if (curRow === maxAllowed - 1) {
            document.getElementById('message').innerText = "WORD WAS: " + target; 
            end(); 
        } else {
            curRow++;
            curGuess = "";
        }
    }

    function end() { 
        gameOver = true; 
        document.getElementById('share').style.display = 'inline-block'; 
    }

    function doShare() {
        const text = `Custom Wordle (${target.length} letters) ${curRow + 1}/${maxAllowed}\n\n${emojis.join('\n')}`;
        navigator.clipboard.writeText(text); 
        alert("Results copied to clipboard!");
    }
</script>
</body>

</html>

